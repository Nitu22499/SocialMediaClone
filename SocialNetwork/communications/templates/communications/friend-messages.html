{% extends 'base.html' %}
{% load static %}

{% block body %}

<div class="container-fluid">
    <div class="row">
        {% include 'includes/sidebar.html' %}
        <div class="col-md-8" style="margin-top:40px">
            {% block center_content %}
            <div class="central-meta">
                <div class="messages">
                    <h5 class="f-title"><i class="fa fa-bell" aria-hidden="true"></i>All Messages </h5>
                    <div class="message-box">
                        <ul class="peoples">
                            {% for friend in friends %}
                            <li>
                                <figure>
                                    {% if friend.sender.username != request.user.username and friend.sender.user_image %}
                                    <a href="#" title=""><img src="{{ friend.sender.user_image.url }}" alt=""></a>
                                    {% elif friend.receiver.username != request.user.username and friend.sender.user_image %}
                                    <a href="#" title=""><img src="{{ friend.receiver.user_image.url }}" alt=""></a>
                                    {% else %}
                                    <a href="#" title=""><img src="{% static 'images/user.jpg' %}" alt=""></a>
                                    {% endif %}
                                </figure>
                                <div class="people-name">
                                    {% if friend.sender.username == request.user.username %}
                                    <a href="{% url 'communications:messages-with-one-friend' friend.receiver.username %}">{{ friend.receiver.username }}</a>
                                    {% else %}
                                    <a href="{% url 'communications:messages-with-one-friend' friend.sender.username %}">{{ friend.sender.username }}</a>
                                    {% endif %}
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                        <div class="peoples-mesg-box">
                            <div class="conversation-head">
                                <figure>
                                    <!-- <p>user{{ user_image_json }} frnd {{ friend_image_json }}</p> -->
                                    {% if friend_image_json != "None" %}
                                    <a href="#" title=""><img src="{{ friend_image_json|slice:'1:-1' }}" alt=""></a>
                                    {% elif user_image_json != "None" %}
                                    <a href="#" title=""><img src="{{ user_image_json |slice:'1:-1'}}" alt=""></a>
                                    {% else %}
                                    <a href="#" title=""><img src="{% static 'images/default.jpg' %}" alt=""></a>
                                    {% endif %}
                                </figure>
                                <span class="friendName" id="{{ friend_name_json|slice:'1:-1' }}">Chat with {{ friend_name_json|slice:"1:-1" }}</span>
                            </div>                          
                            <div>
                                <ul id="messages" class="messages">
                                    <!-- {# Messages go here #} -->
                                    {% for chat in chat %}
                                        {% if chat.author.username == request.user.username %}
                                            <li class="message right">
                                                <div class="avatar">{{ chat.friend}}</div>
                                                    <div class="text_wrapper">
                                                        <div class="text">{{chat.message}}<br>
                                                        <span class="small">{{chat.timestamp}}</span>
                                                    </div>
                                                </div>
                                            </li>
                                        {% else %}
                                            <li class="message left">
                                                <div class="avatar">{{ chat.author.username}}</div>
                                                    <div class="text_wrapper">
                                                        <div class="text">{{chat.message}}<br>
                                                        <span class="small">{{chat.timestamp}}</span>
                                                    </div>
                                                </div>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="panel-footer">
                                <div class="input-group">
                                    <form onsubmit="" method = "POST">
                                        {% csrf_token %}
                                        <input type="hidden" id="userid" value={{request.user.username}}>
                                         <input id="chat-input" type="text" class="form-control input"
                                                placeholder="Type your message here ..."
                                                maxlength="500">
                                        <span class="input-group-btn">
                                            <button class="btn btn-info btn" id="btn-send">Send</button>
                                        </span>
                                    </form>                                          
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
             {% endblock %}
        </div>
    </div>
</div>


<script type="text/javascript" src="{% static 'js/vendor/jquery-3.5.1.min.js' %}"></script>
  <script type="text/javascript"> window.CSRF_TOKEN = "{{ csrf_token }}"; </script>
  <script type="text/javascript" src="{% static 'js/message.js' %}"></script>




{% endblock %}